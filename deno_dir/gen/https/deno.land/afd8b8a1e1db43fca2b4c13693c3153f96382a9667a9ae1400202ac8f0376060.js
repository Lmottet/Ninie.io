import { endpoints } from "../constants/discord.ts";
import { cacheHandlers } from "../controllers/cache.ts";
import { RequestManager } from "../module/requestManager.ts";
import { structures } from "../structures/mod.ts";
import { ChannelTypes, } from "../types/channel.ts";
import { Errors } from "../types/errors.ts";
import { Permissions } from "../types/permission.ts";
import { botHasChannelPermissions } from "../utils/permissions.ts";
export function channelOverwriteHasPermission(guildID, id, overwrites, permissions) {
    const overwrite = overwrites.find((perm) => perm.id === id) ||
        overwrites.find((perm) => perm.id === guildID);
    return permissions.every((perm) => {
        if (overwrite) {
            if (BigInt(overwrite.deny) & BigInt(perm))
                return false;
            if (BigInt(overwrite.allow) & BigInt(perm))
                return true;
        }
        return false;
    });
}
export async function getMessage(channelID, id) {
    const hasViewChannelPerm = await botHasChannelPermissions(channelID, [Permissions.VIEW_CHANNEL]);
    if (!hasViewChannelPerm) {
        throw new Error(Errors.MISSING_VIEW_CHANNEL);
    }
    const hasReadMessageHistoryPerm = await botHasChannelPermissions(channelID, [Permissions.READ_MESSAGE_HISTORY]);
    if (!hasReadMessageHistoryPerm) {
        throw new Error(Errors.MISSING_READ_MESSAGE_HISTORY);
    }
    const result = await RequestManager.get(endpoints.CHANNEL_MESSAGE(channelID, id));
    return structures.createMessage(result);
}
export async function getMessages(channelID, options) {
    const hasViewChannelPerm = await botHasChannelPermissions(channelID, [Permissions.VIEW_CHANNEL]);
    if (!hasViewChannelPerm) {
        throw new Error(Errors.MISSING_VIEW_CHANNEL);
    }
    const hasReadMessageHistoryPerm = await botHasChannelPermissions(channelID, [Permissions.READ_MESSAGE_HISTORY]);
    if (!hasReadMessageHistoryPerm) {
        throw new Error(Errors.MISSING_READ_MESSAGE_HISTORY);
    }
    if (options?.limit && options.limit > 100)
        return;
    const result = (await RequestManager.get(endpoints.CHANNEL_MESSAGES(channelID), options));
    return Promise.all(result.map((res) => structures.createMessage(res)));
}
export async function getPins(channelID) {
    const result = (await RequestManager.get(endpoints.CHANNEL_PINS(channelID)));
    return Promise.all(result.map((res) => structures.createMessage(res)));
}
export async function sendMessage(channelID, content) {
    if (typeof content === "string")
        content = { content };
    const hasSendMessagesPerm = await botHasChannelPermissions(channelID, [Permissions.SEND_MESSAGES]);
    if (!hasSendMessagesPerm) {
        throw new Error(Errors.MISSING_SEND_MESSAGES);
    }
    const hasSendTtsMessagesPerm = await botHasChannelPermissions(channelID, [Permissions.SEND_TTS_MESSAGES]);
    if (content.tts &&
        !hasSendTtsMessagesPerm) {
        throw new Error(Errors.MISSING_SEND_TTS_MESSAGE);
    }
    const hasEmbedLinksPerm = await botHasChannelPermissions(channelID, [Permissions.EMBED_LINKS]);
    if (content.embed &&
        !hasEmbedLinksPerm) {
        throw new Error(Errors.MISSING_EMBED_LINKS);
    }
    if (content.content && [...content.content].length > 2000) {
        throw new Error(Errors.MESSAGE_MAX_LENGTH);
    }
    if (content.mentions) {
        if (content.mentions.users?.length) {
            if (content.mentions.parse?.includes("users")) {
                content.mentions.parse = content.mentions.parse.filter((p) => p !== "users");
            }
            if (content.mentions.users.length > 100) {
                content.mentions.users = content.mentions.users.slice(0, 100);
            }
        }
        if (content.mentions.roles?.length) {
            if (content.mentions.parse?.includes("roles")) {
                content.mentions.parse = content.mentions.parse.filter((p) => p !== "roles");
            }
            if (content.mentions.roles.length > 100) {
                content.mentions.roles = content.mentions.roles.slice(0, 100);
            }
        }
    }
    const channel = await cacheHandlers.get("channels", channelID);
    if (!channel)
        throw new Error(Errors.CHANNEL_NOT_FOUND);
    if (![ChannelTypes.DM, ChannelTypes.GUILD_NEWS, ChannelTypes.GUILD_TEXT]
        .includes(channel.type)) {
        throw new Error(Errors.CHANNEL_NOT_TEXT_BASED);
    }
    const result = await RequestManager.post(endpoints.CHANNEL_MESSAGES(channelID), {
        ...content,
        allowed_mentions: content.mentions,
    });
    return structures.createMessage(result);
}
export async function deleteMessages(channelID, ids, reason) {
    const hasManageMessages = await botHasChannelPermissions(channelID, [Permissions.MANAGE_MESSAGES]);
    if (!hasManageMessages) {
        throw new Error(Errors.MISSING_MANAGE_MESSAGES);
    }
    if (ids.length < 2) {
        throw new Error(Errors.DELETE_MESSAGES_MIN);
    }
    if (ids.length > 100) {
        console.warn(`This endpoint only accepts a maximum of 100 messages. Deleting the first 100 message ids provided.`);
    }
    return RequestManager.post(endpoints.CHANNEL_BULK_DELETE(channelID), {
        messages: ids.splice(0, 100),
        reason,
    });
}
export async function getChannelInvites(channelID) {
    const hasManagaChannels = await botHasChannelPermissions(channelID, [Permissions.MANAGE_CHANNELS]);
    if (!hasManagaChannels) {
        throw new Error(Errors.MISSING_MANAGE_CHANNELS);
    }
    return RequestManager.get(endpoints.CHANNEL_INVITES(channelID));
}
export async function createInvite(channelID, options) {
    const hasCreateInstantInvitePerm = await botHasChannelPermissions(channelID, [Permissions.CREATE_INSTANT_INVITE]);
    if (!hasCreateInstantInvitePerm) {
        throw new Error(Errors.MISSING_CREATE_INSTANT_INVITE);
    }
    return RequestManager.post(endpoints.CHANNEL_INVITES(channelID), options);
}
export async function getChannelWebhooks(channelID) {
    const hasManageWebhooksPerm = await botHasChannelPermissions(channelID, [Permissions.MANAGE_WEBHOOKS]);
    if (!hasManageWebhooksPerm) {
        throw new Error(Errors.MISSING_MANAGE_WEBHOOKS);
    }
    return RequestManager.get(endpoints.CHANNEL_WEBHOOKS(channelID));
}
const editChannelNameTopicQueue = new Map();
let editChannelProcessing = false;
function processEditChannelQueue() {
    if (!editChannelProcessing)
        return;
    const now = Date.now();
    editChannelNameTopicQueue.forEach((request) => {
        if (now > request.timestamp)
            return;
        if (!request.items.length) {
            return editChannelNameTopicQueue.delete(request.channelID);
        }
        request.amount = 0;
        const details = request.items.shift();
        if (!details)
            return;
        editChannel(details.channelID, details.options);
        const secondDetails = request.items.shift();
        if (!secondDetails)
            return;
        return editChannel(secondDetails.channelID, secondDetails.options);
    });
    if (editChannelNameTopicQueue.size) {
        setTimeout(() => processEditChannelQueue(), 600000);
    }
    else {
        editChannelProcessing = false;
    }
}
export async function editChannel(channelID, options) {
    const hasManageChannelsPerm = await botHasChannelPermissions(channelID, [Permissions.MANAGE_CHANNELS]);
    if (!hasManageChannelsPerm) {
        throw new Error(Errors.MISSING_MANAGE_CHANNELS);
    }
    if (options.name || options.topic) {
        const request = editChannelNameTopicQueue.get(channelID);
        if (!request) {
            editChannelNameTopicQueue.set(channelID, {
                channelID: channelID,
                amount: 1,
                timestamp: Date.now() + 600000,
                items: [],
            });
        }
        else if (request.amount === 1) {
            request.amount = 2;
            request.timestamp = Date.now() + 600000;
        }
        else {
            request.items.push({ channelID, options });
            if (editChannelProcessing)
                return;
            editChannelProcessing = true;
            processEditChannelQueue();
            return;
        }
    }
    const payload = {
        ...options,
        rate_limit_per_user: options.slowmode,
        parent_id: options.parentID,
        user_limit: options.userLimit,
        permission_overwrites: options.overwrites?.map((overwrite) => {
            return {
                ...overwrite,
                allow: overwrite.allow.reduce((bits, perm) => bits |= BigInt(Permissions[perm]), BigInt(0)).toString(),
                deny: overwrite.deny.reduce((bits, perm) => bits |= BigInt(Permissions[perm]), BigInt(0)).toString(),
            };
        }),
    };
    return RequestManager.patch(endpoints.GUILD_CHANNEL(channelID), payload);
}
export async function followChannel(sourceChannelID, targetChannelID) {
    const hasManageWebhooksPerm = await botHasChannelPermissions(targetChannelID, [Permissions.MANAGE_WEBHOOKS]);
    if (!hasManageWebhooksPerm) {
        throw new Error(Errors.MISSING_MANAGE_CHANNELS);
    }
    const data = await RequestManager.post(endpoints.CHANNEL_FOLLOW(sourceChannelID), {
        webhook_channel_id: targetChannelID,
    });
    return data.webhook_id;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbm5lbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNoYW5uZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDN0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFFTCxZQUFZLEdBUWIsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFHNUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3JELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBR25FLE1BQU0sVUFBVSw2QkFBNkIsQ0FDM0MsT0FBZSxFQUNmLEVBQVUsRUFDVixVQUEwQixFQUMxQixXQUEwQjtJQUUxQixNQUFNLFNBQVMsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUN6RCxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLE9BQU8sQ0FBQyxDQUFDO0lBRWpELE9BQU8sV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ2hDLElBQUksU0FBUyxFQUFFO1lBQ2IsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQUUsT0FBTyxLQUFLLENBQUM7WUFDeEQsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLE1BQU0s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