import Collection from "./collection.ts";
import { delay } from "https://deno.land/std@0.61.0/async/delay.ts";
export const cache = {
    guilds: new Collection(),
    channels: new Collection(),
    messages: new Collection(),
    unavailableGuilds: new Collection(),
};
async function cleanMessageCache() {
    const messagesPerChannel = new Map();
    for (const message of cache.messages.values()) {
        if ((message.guildID && !cache.guilds.has(message.guildID)) ||
            !cache.channels.has(message.channelID)) {
            cache.messages.delete(message.id);
        }
        const channel = messagesPerChannel.get(message.channelID);
        if (!channel) {
            messagesPerChannel.set(message.channelID, [message]);
        }
        else {
            channel.push(message);
        }
    }
    messagesPerChannel.forEach((messages) => {
        if (messages.length < 100)
            return;
        const sortedMessages = messages.sort((a, b) => b.timestamp - a.timestamp);
        sortedMessages.slice(100).forEach((message) => cache.messages.delete(message.id));
    });
    await delay(60000);
    cleanMessageCache();
}
cleanMessageCache();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYWNoZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLFVBQVUsTUFBTSxpQkFBaUIsQ0FBQztBQUl6QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFTcEUsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUFjO0lBQzlCLE1BQU0sRUFBRSxJQUFJLFVBQVUsRUFBRTtJQUN4QixRQUFRLEVBQUUsSUFBSSxVQUFVLEVBQUU7SUFDMUIsUUFBUSxFQUFFLElBQUksVUFBVSxFQUFFO0lBQzFCLGlCQUFpQixFQUFFLElBQUksVUFBVSxFQUFFO0NBQ3BDLENBQUM7QUFFRixLQUFLLFVBQVUsaUJBQWlCO0lBRTlCLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxHQUFHLEVBQXFCLENBQUM7SUFFeEQsS0FBSyxNQUFNLE9BQU8sSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxFQUFFO1FBQzdDLElBRUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXZELENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUN0QztZQUNBLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUNuQztRQUVELE1BQU0sT0FBTyxHQUFHLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNaLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUN0RDthQUFNO1lBQ0wsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN2QjtLQUNGO0lBRUQsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7UUFDdEMsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLEdBQUc7WUFBRSxPQUFPO1FBR2xDLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUUxRSxjQUFjLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQzVDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FDbEMsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBR0gsTUFBTSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkIsaUJBQWlCLEVBQUUsQ0FBQztBQUN0QixDQUFDO0FBRUQsaUJBQWlCLEVBQUUsQ0FBQyJ9