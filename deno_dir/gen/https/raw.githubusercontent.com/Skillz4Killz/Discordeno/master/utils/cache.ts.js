import Collection from "./collection.ts";
import { delay } from "https://deno.land/std@0.61.0/async/delay.ts";
export const cache = {
    guilds: new Collection(),
    channels: new Collection(),
    messages: new Collection(),
    unavailableGuilds: new Collection(),
    presences: new Collection(),
};
async function cleanMessageCache() {
    const messagesPerChannel = new Map();
    for (const message of cache.messages.values()) {
        if ((message.guildID && !cache.guilds.has(message.guildID)) ||
            !cache.channels.has(message.channelID)) {
            cache.messages.delete(message.id);
        }
        const channel = messagesPerChannel.get(message.channelID);
        if (!channel) {
            messagesPerChannel.set(message.channelID, [message]);
        }
        else {
            channel.push(message);
        }
    }
    messagesPerChannel.forEach((messages) => {
        if (messages.length < 100)
            return;
        const sortedMessages = messages.sort((a, b) => b.timestamp - a.timestamp);
        sortedMessages.slice(100).forEach((message) => cache.messages.delete(message.id));
    });
    await delay(60000);
    cleanMessageCache();
}
cleanMessageCache();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYWNoZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLFVBQVUsTUFBTSxpQkFBaUIsQ0FBQztBQUl6QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFXcEUsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUFjO0lBQzlCLE1BQU0sRUFBRSxJQUFJLFVBQVUsRUFBRTtJQUN4QixRQUFRLEVBQUUsSUFBSSxVQUFVLEVBQUU7SUFDMUIsUUFBUSxFQUFFLElBQUksVUFBVSxFQUFFO0lBQzFCLGlCQUFpQixFQUFFLElBQUksVUFBVSxFQUFFO0lBQ25DLFNBQVMsRUFBRSxJQUFJLFVBQVUsRUFBRTtDQUM1QixDQUFDO0FBRUYsS0FBSyxVQUFVLGlCQUFpQjtJQUU5QixNQUFNLGtCQUFrQixHQUFHLElBQUksR0FBRyxFQUFxQixDQUFDO0lBRXhELEtBQUssTUFBTSxPQUFPLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsRUFBRTtRQUM3QyxJQUVFLENBQUMsT0FBTyxDQUFDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUV2RCxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFDdEM7WUFDQSxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDbkM7UUFFRCxNQUFNLE9BQU8sR0FBRyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixrQkFBa0IsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDdEQ7YUFBTTtZQUNMLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDdkI7S0FDRjtJQUVELGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFO1FBQ3RDLElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxHQUFHO1lBQUUsT0FBTztRQUdsQyxNQUFNLGNBQWMsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFMUUsY0FBYyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUM1QyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQ2xDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUdILE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25CLGlCQUFpQixFQUFFLENBQUM7QUFDdEIsQ0FBQztBQUVELGlCQUFpQixFQUFFLENBQUMifQ==